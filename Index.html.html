<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#F5F1E8">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="manifest" href="manifest.json">
  <title>Mon Bullet Journal üìî</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@400;500;600;700&family=Patrick+Hand&family=Kalam:wght@300;400;700&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    :root {
      --paper: #F5F1E8;
      --ink: #2C3E50;
      --ink-light: #6B7280;
      --cream: #FFF9F0;
      --sage: #A8B5A0;
      --terracotta: #D4A59A;
      --sky: #B8D4E3;
      --lavender: #C9B8D9;
      --peach: #F4C2A5;
    }

    * {
      font-family: 'Patrick Hand', cursive;
      -webkit-tap-highlight-color: transparent;
    }

    .font-handwritten {
      font-family: 'Caveat', cursive;
    }

    .font-script {
      font-family: 'Kalam', cursive;
    }

    body {
      background: linear-gradient(135deg, #F5F1E8 0%, #EDE5D8 50%, #F5F1E8 100%);
      position: relative;
      overscroll-behavior: none;
      user-select: none;
      -webkit-user-select: none;
    }

    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-image: 
        /* Grille √† points visible */
        radial-gradient(circle, #C4B5A0 1.5px, transparent 1.5px),
        /* Texture papier */
        url("data:image/svg+xml,%3Csvg width='100' height='100' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' /%3E%3CfeColorMatrix values='0 0 0 0 0, 0 0 0 0 0, 0 0 0 0 0, 0 0 0 0.05 0'/%3E%3C/filter%3E%3Crect width='100' height='100' filter='url(%23noise)'/%3E%3C/svg%3E");
      background-size: 20px 20px, 100px 100px;
      background-position: 0 0, 0 0;
      pointer-events: none;
      opacity: 0.8;
      z-index: 0;
    }

    body::after {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-image: 
        /* Petites fleurs coin haut gauche */
        url("data:image/svg+xml,%3Csvg width='200' height='200' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='30' cy='30' r='3' fill='%23A8B5A0' opacity='0.15'/%3E%3Ccircle cx='40' cy='25' r='3' fill='%23A8B5A0' opacity='0.15'/%3E%3Ccircle cx='35' cy='35' r='3' fill='%23A8B5A0' opacity='0.15'/%3E%3Ccircle cx='25' cy='35' r='3' fill='%23A8B5A0' opacity='0.15'/%3E%3Ccircle cx='30' cy='40' r='3' fill='%23A8B5A0' opacity='0.15'/%3E%3Ccircle cx='35' cy='30' r='2' fill='%23D4A59A' opacity='0.2'/%3E%3Cpath d='M 15 50 Q 20 45 25 50' stroke='%23C9B8D9' stroke-width='1.5' fill='none' opacity='0.2'/%3E%3Cpath d='M 45 50 Q 50 55 55 50' stroke='%23B8D4E3' stroke-width='1.5' fill='none' opacity='0.2'/%3E%3Cpath d='M 50 15 L 52 20 L 48 20 Z' fill='%23F4C2A5' opacity='0.15'/%3E%3Cpath d='M 20 55 L 22 60 L 18 60 Z' fill='%23F4C2A5' opacity='0.15'/%3E%3C/svg%3E"),
        /* Feuilles coin bas droit */
        url("data:image/svg+xml,%3Csvg width='200' height='200' xmlns='http://www.w3.org/2000/svg'%3E%3Cellipse cx='170' cy='170' rx='15' ry='8' fill='%23A8B5A0' opacity='0.12' transform='rotate(-30 170 170)'/%3E%3Cellipse cx='165' cy='180' rx='12' ry='6' fill='%23A8B5A0' opacity='0.12' transform='rotate(-45 165 180)'/%3E%3Cellipse cx='180' cy='175' rx='14' ry='7' fill='%23A8B5A0' opacity='0.12' transform='rotate(-15 180 175)'/%3E%3Cpath d='M 150 150 Q 155 145 160 150' stroke='%23D4A59A' stroke-width='1.5' fill='none' opacity='0.15'/%3E%3Cpath d='M 175 155 Q 180 150 185 155' stroke='%23C9B8D9' stroke-width='1.5' fill='none' opacity='0.15'/%3E%3Ccircle cx='155' cy='165' r='2' fill='%23F4C2A5' opacity='0.2'/%3E%3Ccircle cx='175' cy='165' r='2' fill='%23B8D4E3' opacity='0.2'/%3E%3Ccircle cx='165' cy='155' r='2' fill='%23F4C2A5' opacity='0.2'/%3E%3C/svg%3E"),
        /* Petites √©toiles dispers√©es */
        url("data:image/svg+xml,%3Csvg width='400' height='400' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M 100 80 L 101 82 L 103 82 L 101 83 L 102 85 L 100 84 L 98 85 L 99 83 L 97 82 L 99 82 Z' fill='%23F4C2A5' opacity='0.2'/%3E%3Cpath d='M 300 120 L 301 122 L 303 122 L 301 123 L 302 125 L 300 124 L 298 125 L 299 123 L 297 122 L 299 122 Z' fill='%23B8D4E3' opacity='0.2'/%3E%3Cpath d='M 150 300 L 151 302 L 153 302 L 151 303 L 152 305 L 150 304 L 148 305 L 149 303 L 147 302 L 149 302 Z' fill='%23C9B8D9' opacity='0.2'/%3E%3Cpath d='M 350 250 L 351 252 L 353 252 L 351 253 L 352 255 L 350 254 L 348 255 L 349 253 L 347 252 L 349 252 Z' fill='%23D4A59A' opacity='0.2'/%3E%3Ccircle cx='80' cy='200' r='1.5' fill='%23A8B5A0' opacity='0.25'/%3E%3Ccircle cx='320' cy='180' r='1.5' fill='%23F4C2A5' opacity='0.25'/%3E%3Ccircle cx='200' cy='350' r='1.5' fill='%23B8D4E3' opacity='0.25'/%3E%3C/svg%3E");
      background-size: 200px 200px, 200px 200px, 400px 400px;
      background-position: top left, bottom right, center;
      background-repeat: no-repeat, no-repeat, repeat;
      pointer-events: none;
      opacity: 1;
      z-index: 0;
    }

    #root {
      position: relative;
      z-index: 1;
    }

    .paper-texture {
      background: 
        linear-gradient(135deg, rgba(255,255,255,0.3) 0%, transparent 100%),
        var(--cream);
      box-shadow: 
        0 1px 3px rgba(0,0,0,0.08),
        0 4px 12px rgba(0,0,0,0.06),
        0 16px 32px -8px rgba(0,0,0,0.1),
        inset 0 1px 0 rgba(255,255,255,0.9),
        inset 0 0 60px rgba(255,253,245,0.5);
      position: relative;
    }

    .paper-texture::before {
      content: '';
      position: absolute;
      inset: 0;
      background-image: 
        /* Texture grain papier */
        url("data:image/svg+xml,%3Csvg viewBox='0 0 400 400' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='2' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.03'/%3E%3C/svg%3E"),
        /* Petits doodles coins */
        url("data:image/svg+xml,%3Csvg width='100' height='100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M 5 5 Q 7 3 9 5' stroke='%23A8B5A0' stroke-width='0.5' fill='none' opacity='0.3'/%3E%3Cpath d='M 95 5 Q 93 3 91 5' stroke='%23D4A59A' stroke-width='0.5' fill='none' opacity='0.3'/%3E%3Cpath d='M 5 95 Q 7 97 9 95' stroke='%23B8D4E3' stroke-width='0.5' fill='none' opacity='0.3'/%3E%3Cpath d='M 95 95 Q 93 97 91 95' stroke='%23F4C2A5' stroke-width='0.5' fill='none' opacity='0.3'/%3E%3C/svg%3E");
      background-size: auto, 100% 100%;
      background-position: center, 0 0;
      pointer-events: none;
      opacity: 0.8;
      border-radius: inherit;
    }

    .paper-texture::after {
      content: '';
      position: absolute;
      inset: -2px;
      background: transparent;
      border: 1px solid rgba(0,0,0,0.03);
      border-radius: inherit;
      pointer-events: none;
    }

    .washi-tape {
      background: 
        repeating-linear-gradient(
          45deg,
          rgba(168, 181, 160, 0.3),
          rgba(168, 181, 160, 0.3) 10px,
          rgba(168, 181, 160, 0.4) 10px,
          rgba(168, 181, 160, 0.4) 20px
        ),
        linear-gradient(135deg, rgba(168, 181, 160, 0.35) 0%, rgba(168, 181, 160, 0.55) 100%);
      box-shadow: 
        0 2px 8px rgba(0,0,0,0.1),
        inset 0 1px 0 rgba(255,255,255,0.3);
      position: relative;
      border: 1px solid rgba(168, 181, 160, 0.2);
    }

    .washi-tape::after {
      content: '';
      position: absolute;
      inset: 0;
      background: 
        repeating-linear-gradient(
          90deg,
          transparent,
          transparent 8px,
          rgba(255,255,255,0.15) 8px,
          rgba(255,255,255,0.15) 10px
        );
      border-radius: inherit;
      pointer-events: none;
    }

    .activity-card {
      transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: grab;
      position: relative;
      border: 2px solid transparent;
    }

    .activity-card::before {
      content: '';
      position: absolute;
      left: -8px;
      top: 50%;
      transform: translateY(-50%);
      width: 4px;
      height: 4px;
      border-radius: 50%;
      background: currentColor;
      opacity: 0.3;
    }

    /* Petit coin d√©cor√© haut droite */
    .activity-card::after {
      content: '‚ú¶';
      position: absolute;
      top: 4px;
      right: 28px;
      font-size: 10px;
      opacity: 0.25;
      color: currentColor;
      filter: drop-shadow(0 1px 1px rgba(255,255,255,0.5));
    }

    .activity-card:active {
      cursor: grabbing;
      transform: scale(1.02) rotate(1deg);
      box-shadow: 0 8px 16px -4px rgba(0,0,0,0.2);
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateX(-30px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    @keyframes scaleIn {
      from {
        opacity: 0;
        transform: scale(0.9);
      }
      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    .animate-fade-in-up {
      animation: fadeInUp 0.5s ease-out forwards;
    }

    .animate-slide-in {
      animation: slideIn 0.4s ease-out forwards;
    }

    .animate-scale-in {
      animation: scaleIn 0.3s ease-out forwards;
    }

    .time-marker {
      position: absolute;
      left: 0;
      right: 0;
      height: 2px;
      background: var(--terracotta);
      opacity: 0.6;
      z-index: 10;
      pointer-events: none;
    }

    .time-marker::before {
      content: '';
      position: absolute;
      left: -6px;
      top: -4px;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: var(--terracotta);
      border: 2px solid var(--cream);
    }

    input[type="time"]::-webkit-calendar-picker-indicator {
      filter: opacity(0.5);
    }

    input[type="color"] {
      width: 60px;
      height: 60px;
      border: 3px solid var(--ink);
      border-radius: 50%;
      cursor: pointer;
      -webkit-appearance: none;
      appearance: none;
      background: none;
    }

    input[type="color"]::-webkit-color-swatch-wrapper {
      padding: 0;
      border-radius: 50%;
    }

    input[type="color"]::-webkit-color-swatch {
      border: none;
      border-radius: 50%;
    }

    .toggle-btn {
      transition: all 0.3s ease;
    }

    .toggle-btn.active {
      background: var(--ink);
      color: var(--cream);
      transform: scale(1.05);
    }

    ::-webkit-scrollbar {
      width: 6px;
    }

    ::-webkit-scrollbar-track {
      background: transparent;
    }

    ::-webkit-scrollbar-thumb {
      background: rgba(0,0,0,0.2);
      border-radius: 10px;
    }

    .dashed-line {
      border-top: 2px dashed rgba(0,0,0,0.1);
    }

    .sticker {
      display: inline-block;
      padding: 4px 12px;
      background: 
        linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(255,255,255,0.85) 100%);
      border: 2px solid currentColor;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 600;
      box-shadow: 
        2px 2px 0 rgba(0,0,0,0.1),
        0 4px 12px rgba(0,0,0,0.08);
      transform: rotate(-2deg);
      position: relative;
    }

    .sticker::before {
      content: '‚ú¶';
      position: absolute;
      top: -8px;
      right: -6px;
      font-size: 12px;
      opacity: 0.4;
    }

    @media (prefers-color-scheme: dark) {
      :root {
        --paper: #2C2416;
        --cream: #3A3020;
        --ink: #E8DCC8;
        --ink-light: #B8AE9F;
      }
      
      body {
        background: linear-gradient(135deg, #2C2416 0%, #3A3020 50%, #2C2416 100%);
      }

      body::before {
        background-image: 
          radial-gradient(circle, #5A4A38 1.5px, transparent 1.5px),
          url("data:image/svg+xml,%3Csvg width='100' height='100' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' /%3E%3CfeColorMatrix values='0 0 0 0 0, 0 0 0 0 0, 0 0 0 0 0, 0 0 0 0.08 0'/%3E%3C/filter%3E%3Crect width='100' height='100' filter='url(%23noise)'/%3E%3C/svg%3E");
      }
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    // Helpers
    const saveToStorage = (key, data) => localStorage.setItem(key, JSON.stringify(data));
    const getFromStorage = (key, defaultValue = null) => {
      const data = localStorage.getItem(key);
      return data ? JSON.parse(data) : defaultValue;
    };

    const DAYS = ['Lundi', 'Mardi', 'Mercredi', 'Jeudi', 'Vendredi'];
    
    const PRESET_COLORS = [
      '#A8B5A0', // sage
      '#D4A59A', // terracotta
      '#B8D4E3', // sky
      '#C9B8D9', // lavender
      '#F4C2A5', // peach
      '#F2C6B4', // coral
      '#A4C3B2', // mint
      '#E8B4B8', // rose
      '#D4D4AA', // khaki
      '#C4A7E7', // lilac
    ];

    function getCurrentTimePosition() {
      const now = new Date();
      const hours = now.getHours();
      const minutes = now.getMinutes();
      const totalMinutes = hours * 60 + minutes;
      const startMinutes = 7 * 60; // 7h00
      const endMinutes = 18 * 60; // 18h00
      const range = endMinutes - startMinutes;
      return ((totalMinutes - startMinutes) / range) * 100;
    }

    function WelcomePage({ onStart }) {
      const [nom, setNom] = useState('');
      const [classe, setClasse] = useState('');

      const handleSubmit = (e) => {
        e.preventDefault();
        if (nom && classe) {
          const profile = { nom, classe };
          saveToStorage('userProfile', profile);
          onStart(profile);
        }
      };

      return (
        <div className="min-h-screen flex items-center justify-center p-4" style={{ position: 'relative' }}>
          {/* D√©corations SVG */}
          <svg style={{ position: 'absolute', top: '10%', left: '5%', opacity: 0.3 }} width="80" height="80" viewBox="0 0 80 80">
            <circle cx="40" cy="20" r="8" fill="#A8B5A0" opacity="0.4"/>
            <circle cx="50" cy="15" r="6" fill="#A8B5A0" opacity="0.4"/>
            <circle cx="45" cy="25" r="6" fill="#A8B5A0" opacity="0.4"/>
            <circle cx="35" cy="25" r="6" fill="#A8B5A0" opacity="0.4"/>
            <circle cx="30" cy="15" r="6" fill="#A8B5A0" opacity="0.4"/>
            <circle cx="40" cy="20" r="4" fill="#D4A59A" opacity="0.5"/>
            <path d="M 20 50 Q 30 40 40 50 T 60 50" stroke="#C9B8D9" strokeWidth="2" fill="none" opacity="0.4"/>
          </svg>

          <svg style={{ position: 'absolute', bottom: '10%', right: '5%', opacity: 0.3 }} width="100" height="100" viewBox="0 0 100 100">
            <ellipse cx="50" cy="30" rx="20" ry="10" fill="#B8D4E3" opacity="0.4" transform="rotate(-30 50 30)"/>
            <ellipse cx="45" cy="45" rx="18" ry="9" fill="#B8D4E3" opacity="0.4" transform="rotate(-45 45 45)"/>
            <ellipse cx="60" cy="40" rx="22" ry="11" fill="#B8D4E3" opacity="0.4" transform="rotate(-15 60 40)"/>
            <path d="M 30 70 L 32 75 L 28 75 Z" fill="#F4C2A5" opacity="0.4"/>
            <path d="M 70 65 L 72 70 L 68 70 Z" fill="#F4C2A5" opacity="0.4"/>
            <circle cx="50" cy="70" r="3" fill="#D4A59A" opacity="0.4"/>
          </svg>

          <svg style={{ position: 'absolute', top: '50%', right: '10%', opacity: 0.2 }} width="60" height="60" viewBox="0 0 60 60">
            <path d="M 30 15 L 31 20 L 36 20 L 32 23 L 34 28 L 30 25 L 26 28 L 28 23 L 24 20 L 29 20 Z" fill="#F4C2A5" opacity="0.6"/>
            <path d="M 20 40 Q 25 35 30 40" stroke="#A8B5A0" strokeWidth="2" fill="none" opacity="0.5"/>
          </svg>

          <div className="w-full max-w-md animate-scale-in" style={{ position: 'relative', zIndex: 1 }}>
            <div className="text-center mb-8">
              <h1 className="text-6xl font-handwritten mb-2" style={{ color: 'var(--ink)' }}>
                Mon Bullet Journal
              </h1>
              <div className="text-4xl mb-4">üìî‚ú®</div>
              <p className="text-lg" style={{ color: 'var(--ink-light)' }}>
                Organise ta semaine en toute simplicit√©
              </p>
            </div>

            <div className="paper-texture rounded-3xl p-8" style={{ border: '3px solid var(--ink)' }}>
              <form onSubmit={handleSubmit} className="space-y-6">
                <div>
                  <label className="block text-lg font-handwritten mb-2" style={{ color: 'var(--ink)' }}>
                    Ton pr√©nom ‚úèÔ∏è
                  </label>
                  <input
                    type="text"
                    value={nom}
                    onChange={(e) => setNom(e.target.value)}
                    className="w-full px-4 py-3 rounded-2xl text-lg font-handwritten"
                    style={{ 
                      border: '2px solid var(--ink)',
                      background: 'var(--paper)',
                      color: 'var(--ink)'
                    }}
                    placeholder="Marie"
                    required
                  />
                </div>

                <div>
                  <label className="block text-lg font-handwritten mb-2" style={{ color: 'var(--ink)' }}>
                    Ta classe üéí
                  </label>
                  <input
                    type="text"
                    value={classe}
                    onChange={(e) => setClasse(e.target.value)}
                    className="w-full px-4 py-3 rounded-2xl text-lg font-handwritten"
                    style={{ 
                      border: '2px solid var(--ink)',
                      background: 'var(--paper)',
                      color: 'var(--ink)'
                    }}
                    placeholder="CP A, CE1..."
                    required
                  />
                </div>

                <button
                  type="submit"
                  className="w-full py-4 rounded-2xl text-xl font-handwritten font-bold transition-all transform hover:scale-105 active:scale-95"
                  style={{
                    background: 'var(--sage)',
                    color: 'var(--cream)',
                    border: '3px solid var(--ink)',
                    boxShadow: '4px 4px 0 var(--ink)'
                  }}
                >
                  Commencer mon journal ‚ú®
                </button>
              </form>
            </div>

            <p className="text-center text-sm mt-6" style={{ color: 'var(--ink-light)' }}>
              Tes donn√©es restent sur ton appareil üîí
            </p>
          </div>
        </div>
      );
    }

    function ActivityModal({ isOpen, onClose, onSave, editingActivity }) {
      const [title, setTitle] = useState('');
      const [startTime, setStartTime] = useState('09:00');
      const [duration, setDuration] = useState(60);
      const [color, setColor] = useState(PRESET_COLORS[0]);
      const [selectedDays, setSelectedDays] = useState([]);

      useEffect(() => {
        if (editingActivity) {
          setTitle(editingActivity.title);
          setStartTime(editingActivity.startTime);
          setDuration(editingActivity.duration);
          setColor(editingActivity.color);
          setSelectedDays([editingActivity.day]);
        } else {
          setTitle('');
          setStartTime('09:00');
          setDuration(60);
          setColor(PRESET_COLORS[0]);
          setSelectedDays([]);
        }
      }, [editingActivity, isOpen]);

      const toggleDay = (day) => {
        setSelectedDays(prev =>
          prev.includes(day) ? prev.filter(d => d !== day) : [...prev, day]
        );
      };

      const handleSubmit = (e) => {
        e.preventDefault();
        if (!title || selectedDays.length === 0) return;

        const activities = selectedDays.map(day => ({
          id: editingActivity?.id || `${Date.now()}-${Math.random()}`,
          title,
          startTime,
          duration,
          color,
          day,
          createdAt: editingActivity?.createdAt || Date.now()
        }));

        onSave(activities, editingActivity?.id);
        onClose();
      };

      if (!isOpen) return null;

      return (
        <div 
          className="fixed inset-0 flex items-center justify-center p-4 z-50 animate-fade-in-up"
          style={{ background: 'rgba(0,0,0,0.4)', backdropFilter: 'blur(8px)' }}
          onClick={onClose}
        >
          <div 
            className="paper-texture rounded-3xl p-6 w-full max-w-lg animate-scale-in"
            style={{ border: '3px solid var(--ink)' }}
            onClick={(e) => e.stopPropagation()}
          >
            <h2 className="text-3xl font-handwritten mb-6" style={{ color: 'var(--ink)' }}>
              {editingActivity ? '‚úèÔ∏è Modifier' : '‚ú® Nouvelle activit√©'}
            </h2>

            <form onSubmit={handleSubmit} className="space-y-5">
              <div>
                <label className="block text-lg font-handwritten mb-2" style={{ color: 'var(--ink)' }}>
                  Titre de l'activit√©
                </label>
                <input
                  type="text"
                  value={title}
                  onChange={(e) => setTitle(e.target.value)}
                  className="w-full px-4 py-3 rounded-2xl text-lg font-handwritten"
                  style={{ 
                    border: '2px solid var(--ink)',
                    background: 'var(--paper)',
                    color: 'var(--ink)'
                  }}
                  placeholder="Math√©matiques, R√©cr√©ation..."
                  required
                />
              </div>

              <div className="grid grid-cols-2 gap-4">
                <div>
                  <label className="block text-lg font-handwritten mb-2" style={{ color: 'var(--ink)' }}>
                    ‚è∞ Heure
                  </label>
                  <input
                    type="time"
                    value={startTime}
                    onChange={(e) => setStartTime(e.target.value)}
                    className="w-full px-4 py-3 rounded-2xl text-lg font-handwritten"
                    style={{ 
                      border: '2px solid var(--ink)',
                      background: 'var(--paper)',
                      color: 'var(--ink)'
                    }}
                    required
                  />
                </div>

                <div>
                  <label className="block text-lg font-handwritten mb-2" style={{ color: 'var(--ink)' }}>
                    ‚è±Ô∏è Dur√©e (min)
                  </label>
                  <select
                    value={duration}
                    onChange={(e) => setDuration(Number(e.target.value))}
                    className="w-full px-4 py-3 rounded-2xl text-lg font-handwritten"
                    style={{ 
                      border: '2px solid var(--ink)',
                      background: 'var(--paper)',
                      color: 'var(--ink)'
                    }}
                  >
                    <option value={15}>15 min</option>
                    <option value={30}>30 min</option>
                    <option value={45}>45 min</option>
                    <option value={60}>1h</option>
                    <option value={90}>1h30</option>
                    <option value={120}>2h</option>
                  </select>
                </div>
              </div>

              <div>
                <label className="block text-lg font-handwritten mb-3" style={{ color: 'var(--ink)' }}>
                  üé® Couleur
                </label>
                <div className="flex flex-wrap gap-3">
                  {PRESET_COLORS.map(presetColor => (
                    <button
                      key={presetColor}
                      type="button"
                      onClick={() => setColor(presetColor)}
                      className="w-12 h-12 rounded-full transition-all"
                      style={{
                        background: presetColor,
                        border: color === presetColor ? '4px solid var(--ink)' : '2px solid var(--ink)',
                        transform: color === presetColor ? 'scale(1.1)' : 'scale(1)'
                      }}
                    />
                  ))}
                  <input
                    type="color"
                    value={color}
                    onChange={(e) => setColor(e.target.value)}
                    title="Couleur personnalis√©e"
                  />
                </div>
              </div>

              <div>
                <label className="block text-lg font-handwritten mb-3" style={{ color: 'var(--ink)' }}>
                  üìÖ Jours
                </label>
                <div className="flex flex-wrap gap-2">
                  {DAYS.map(day => (
                    <button
                      key={day}
                      type="button"
                      onClick={() => toggleDay(day)}
                      className="px-4 py-2 rounded-xl font-handwritten transition-all"
                      style={{
                        background: selectedDays.includes(day) ? 'var(--ink)' : 'var(--paper)',
                        color: selectedDays.includes(day) ? 'var(--cream)' : 'var(--ink)',
                        border: '2px solid var(--ink)',
                        transform: selectedDays.includes(day) ? 'scale(1.05)' : 'scale(1)'
                      }}
                    >
                      {day}
                    </button>
                  ))}
                </div>
              </div>

              <div className="flex gap-3 pt-4">
                <button
                  type="button"
                  onClick={onClose}
                  className="flex-1 py-3 rounded-2xl font-handwritten text-lg transition-all"
                  style={{
                    background: 'var(--paper)',
                    color: 'var(--ink)',
                    border: '2px solid var(--ink)'
                  }}
                >
                  Annuler
                </button>
                <button
                  type="submit"
                  className="flex-1 py-3 rounded-2xl font-handwritten text-lg font-bold transition-all"
                  style={{
                    background: color,
                    color: 'var(--cream)',
                    border: '3px solid var(--ink)',
                    boxShadow: '3px 3px 0 var(--ink)'
                  }}
                >
                  {editingActivity ? 'Modifier' : 'Ajouter'}
                </button>
              </div>
            </form>
          </div>
        </div>
      );
    }

    function ActivityCard({ activity, onEdit, onDelete }) {
      const [startHour, startMinute] = activity.startTime.split(':').map(Number);
      const totalStartMinutes = startHour * 60 + startMinute;
      const startOfDay = 7 * 60; // 7h
      const endOfDay = 18 * 60; // 18h
      const dayRange = endOfDay - startOfDay;
      
      const top = ((totalStartMinutes - startOfDay) / dayRange) * 100;
      const height = (activity.duration / dayRange) * 100;

      return (
        <div
          className="activity-card absolute left-2 right-2 rounded-2xl p-3"
          style={{
            top: `${top}%`,
            height: `${Math.max(height, 8)}%`,
            background: activity.color,
            color: 'var(--cream)',
            border: '2px solid var(--ink)',
            boxShadow: '2px 2px 0 var(--ink)',
            minHeight: '60px'
          }}
          onClick={() => onEdit(activity)}
        >
          <div className="flex justify-between items-start">
            <div className="flex-1 pr-2">
              <div className="font-bold text-base leading-tight mb-1 font-handwritten">
                {activity.title}
              </div>
              <div className="text-sm opacity-90">
                {activity.startTime} ‚Ä¢ {activity.duration}min
              </div>
            </div>
            <button
              onClick={(e) => {
                e.stopPropagation();
                onDelete(activity.id);
              }}
              className="text-lg opacity-70 hover:opacity-100 transition-opacity"
            >
              ‚úï
            </button>
          </div>
        </div>
      );
    }

    function DayView({ activities, selectedDay, onEdit, onDelete }) {
      const dayActivities = activities.filter(a => a.day === selectedDay);
      const [currentTimePos, setCurrentTimePos] = useState(getCurrentTimePosition());

      useEffect(() => {
        const interval = setInterval(() => {
          setCurrentTimePos(getCurrentTimePosition());
        }, 60000);
        return () => clearInterval(interval);
      }, []);

      return (
        <div className="space-y-4">
          <h2 className="text-4xl font-handwritten text-center mb-6" style={{ color: 'var(--ink)' }}>
            {selectedDay}
          </h2>

          <div className="paper-texture rounded-3xl p-6 relative" style={{ border: '3px solid var(--ink)', minHeight: '600px' }}>
            <div className="relative" style={{ height: '660px' }}>
              {/* Lignes horaires */}
              {[7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18].map(hour => {
                const pos = ((hour - 7) / 11) * 100;
                return (
                  <div
                    key={hour}
                    className="absolute left-0 right-0 flex items-center"
                    style={{ top: `${pos}%` }}
                  >
                    <div className="w-16 text-right pr-3 font-handwritten text-lg" style={{ color: 'var(--ink-light)' }}>
                      {hour}h
                    </div>
                    <div className="flex-1 dashed-line" />
                  </div>
                );
              })}

              {/* Indicateur heure actuelle */}
              {currentTimePos >= 0 && currentTimePos <= 100 && (
                <div className="time-marker" style={{ top: `${currentTimePos}%` }} />
              )}

              {/* Activit√©s */}
              <div className="absolute left-20 right-0 top-0 bottom-0">
                {dayActivities.map(activity => (
                  <ActivityCard
                    key={activity.id}
                    activity={activity}
                    onEdit={onEdit}
                    onDelete={onDelete}
                  />
                ))}
              </div>
            </div>
          </div>
        </div>
      );
    }

    function WeekView({ activities, onEdit, onDelete }) {
      return (
        <div className="space-y-4">
          <h2 className="text-4xl font-handwritten text-center mb-6" style={{ color: 'var(--ink)' }}>
            Ma Semaine
          </h2>

          <div className="grid grid-cols-1 md:grid-cols-5 gap-4">
            {DAYS.map((day, index) => {
              const dayActivities = activities.filter(a => a.day === day);
              return (
                <div 
                  key={day}
                  className="paper-texture rounded-2xl p-4 animate-slide-in"
                  style={{ 
                    border: '2px solid var(--ink)',
                    animationDelay: `${index * 0.1}s`
                  }}
                >
                  <h3 className="text-2xl font-handwritten mb-3 text-center" style={{ color: 'var(--ink)' }}>
                    {day}
                  </h3>
                  <div className="space-y-2">
                    {dayActivities
                      .sort((a, b) => a.startTime.localeCompare(b.startTime))
                      .map(activity => (
                        <div
                          key={activity.id}
                          className="rounded-xl p-3 cursor-pointer transition-all hover:scale-105"
                          style={{
                            background: activity.color,
                            color: 'var(--cream)',
                            border: '2px solid var(--ink)',
                            boxShadow: '2px 2px 0 var(--ink)'
                          }}
                          onClick={() => onEdit(activity)}
                        >
                          <div className="font-bold text-sm mb-1">{activity.title}</div>
                          <div className="text-xs opacity-90">{activity.startTime}</div>
                        </div>
                      ))}
                    {dayActivities.length === 0 && (
                      <div className="text-center py-8" style={{ color: 'var(--ink-light)' }}>
                        <div className="text-2xl mb-2">‚ú®</div>
                        <div className="text-sm">Aucune activit√©</div>
                      </div>
                    )}
                  </div>
                </div>
              );
            })}
          </div>
        </div>
      );
    }

    function Dashboard({ userProfile, onLogout }) {
      const [activities, setActivities] = useState([]);
      const [viewMode, setViewMode] = useState('week'); // 'day' or 'week'
      const [selectedDay, setSelectedDay] = useState(DAYS[new Date().getDay() - 1] || DAYS[0]);
      const [modalOpen, setModalOpen] = useState(false);
      const [editingActivity, setEditingActivity] = useState(null);

      useEffect(() => {
        const saved = getFromStorage('activities', []);
        setActivities(saved);
      }, []);

      useEffect(() => {
        saveToStorage('activities', activities);
      }, [activities]);

      const handleSaveActivity = (newActivities, editingId) => {
        if (editingId) {
          // Mode √©dition : remplacer l'activit√©
          setActivities(activities.map(a => 
            a.id === editingId ? newActivities[0] : a
          ));
        } else {
          // Mode ajout : ajouter toutes les nouvelles activit√©s
          setActivities([...activities, ...newActivities]);
        }
      };

      const handleEditActivity = (activity) => {
        setEditingActivity(activity);
        setModalOpen(true);
      };

      const handleDeleteActivity = (id) => {
        if (confirm('Supprimer cette activit√© ?')) {
          setActivities(activities.filter(a => a.id !== id));
        }
      };

      const handleAddNew = () => {
        setEditingActivity(null);
        setModalOpen(true);
      };

      return (
        <div className="min-h-screen p-4 md:p-8 pb-24">
          <div className="max-w-7xl mx-auto">
            {/* Header */}
            <div className="mb-8 animate-fade-in-up">
              <div className="paper-texture rounded-3xl p-6" style={{ border: '3px solid var(--ink)' }}>
                <div className="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                  <div>
                    <h1 className="text-4xl md:text-5xl font-handwritten mb-2" style={{ color: 'var(--ink)' }}>
                      Hello {userProfile.nom} ! üëã
                    </h1>
                    <div className="sticker" style={{ color: 'var(--terracotta)', borderColor: 'var(--terracotta)' }}>
                      {userProfile.classe}
                    </div>
                  </div>
                  <button
                    onClick={onLogout}
                    className="px-6 py-3 rounded-2xl font-handwritten text-lg transition-all"
                    style={{
                      background: 'var(--paper)',
                      color: 'var(--ink)',
                      border: '2px solid var(--ink)'
                    }}
                  >
                    D√©connexion
                  </button>
                </div>
              </div>
            </div>

            {/* View Toggle */}
            <div className="flex justify-center gap-3 mb-8">
              <button
                onClick={() => setViewMode('day')}
                className={`toggle-btn px-8 py-3 rounded-2xl font-handwritten text-xl ${viewMode === 'day' ? 'active' : ''}`}
                style={{
                  background: viewMode === 'day' ? 'var(--ink)' : 'var(--paper)',
                  color: viewMode === 'day' ? 'var(--cream)' : 'var(--ink)',
                  border: '3px solid var(--ink)',
                  boxShadow: viewMode === 'day' ? '3px 3px 0 var(--terracotta)' : 'none'
                }}
              >
                üìÖ Jour
              </button>
              <button
                onClick={() => setViewMode('week')}
                className={`toggle-btn px-8 py-3 rounded-2xl font-handwritten text-xl ${viewMode === 'week' ? 'active' : ''}`}
                style={{
                  background: viewMode === 'week' ? 'var(--ink)' : 'var(--paper)',
                  color: viewMode === 'week' ? 'var(--cream)' : 'var(--ink)',
                  border: '3px solid var(--ink)',
                  boxShadow: viewMode === 'week' ? '3px 3px 0 var(--sage)' : 'none'
                }}
              >
                üìÜ Semaine
              </button>
            </div>

            {/* Day selector for day view */}
            {viewMode === 'day' && (
              <div className="flex justify-center gap-2 mb-6 overflow-x-auto pb-2">
                {DAYS.map(day => (
                  <button
                    key={day}
                    onClick={() => setSelectedDay(day)}
                    className="px-4 py-2 rounded-xl font-handwritten text-lg whitespace-nowrap transition-all"
                    style={{
                      background: selectedDay === day ? 'var(--sage)' : 'var(--paper)',
                      color: selectedDay === day ? 'var(--cream)' : 'var(--ink)',
                      border: '2px solid var(--ink)',
                      transform: selectedDay === day ? 'scale(1.05)' : 'scale(1)'
                    }}
                  >
                    {day}
                  </button>
                ))}
              </div>
            )}

            {/* Main View */}
            {viewMode === 'day' ? (
              <DayView
                activities={activities}
                selectedDay={selectedDay}
                onEdit={handleEditActivity}
                onDelete={handleDeleteActivity}
              />
            ) : (
              <WeekView
                activities={activities}
                onEdit={handleEditActivity}
                onDelete={handleDeleteActivity}
              />
            )}

            {/* Stats */}
            <div className="mt-8 grid grid-cols-2 md:grid-cols-4 gap-4">
              <div className="paper-texture rounded-2xl p-4 text-center" style={{ border: '2px solid var(--ink)' }}>
                <div className="text-3xl font-bold font-handwritten" style={{ color: 'var(--sage)' }}>
                  {activities.length}
                </div>
                <div className="text-sm" style={{ color: 'var(--ink-light)' }}>Activit√©s</div>
              </div>
              <div className="paper-texture rounded-2xl p-4 text-center" style={{ border: '2px solid var(--ink)' }}>
                <div className="text-3xl font-bold font-handwritten" style={{ color: 'var(--terracotta)' }}>
                  {DAYS.filter(day => activities.some(a => a.day === day)).length}
                </div>
                <div className="text-sm" style={{ color: 'var(--ink-light)' }}>Jours remplis</div>
              </div>
              <div className="paper-texture rounded-2xl p-4 text-center" style={{ border: '2px solid var(--ink)' }}>
                <div className="text-3xl font-bold font-handwritten" style={{ color: 'var(--sky)' }}>
                  {Math.round(activities.reduce((sum, a) => sum + a.duration, 0) / 60)}h
                </div>
                <div className="text-sm" style={{ color: 'var(--ink-light)' }}>Total</div>
              </div>
              <div className="paper-texture rounded-2xl p-4 text-center" style={{ border: '2px solid var(--ink)' }}>
                <div className="text-3xl font-bold font-handwritten" style={{ color: 'var(--lavender)' }}>
                  {new Set(activities.map(a => a.title)).size}
                </div>
                <div className="text-sm" style={{ color: 'var(--ink-light)' }}>Types</div>
              </div>
            </div>
          </div>

          {/* Floating Add Button */}
          <button
            onClick={handleAddNew}
            className="fixed bottom-8 right-8 w-16 h-16 rounded-full flex items-center justify-center text-3xl transition-all transform hover:scale-110 active:scale-95 z-50"
            style={{
              background: 'linear-gradient(135deg, #A8B5A0 0%, #8A9780 100%)',
              color: 'var(--cream)',
              border: '3px solid var(--ink)',
              boxShadow: '4px 4px 0 var(--ink), 0 0 0 6px rgba(168, 181, 160, 0.2)'
            }}
          >
            ‚úèÔ∏è
          </button>

          <ActivityModal
            isOpen={modalOpen}
            onClose={() => {
              setModalOpen(false);
              setEditingActivity(null);
            }}
            onSave={handleSaveActivity}
            editingActivity={editingActivity}
          />
        </div>
      );
    }

    function App() {
      const [userProfile, setUserProfile] = useState(null);

      useEffect(() => {
        const profile = getFromStorage('userProfile');
        if (profile) {
          setUserProfile(profile);
        }
      }, []);

      const handleStart = (profile) => {
        setUserProfile(profile);
      };

      const handleLogout = () => {
        if (confirm('Te d√©connecter ? Tes activit√©s seront conserv√©es.')) {
          setUserProfile(null);
        }
      };

      return userProfile ? (
        <Dashboard userProfile={userProfile} onLogout={handleLogout} />
      ) : (
        <WelcomePage onStart={handleStart} />
      );
    }

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>