<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#F5F1E8">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="manifest" href="manifest.json">
  <title>Mon Bullet Journal üìî</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@400;500;600;700&family=Patrick+Hand&family=Kalam:wght@300;400;700&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    :root {
      --paper: #F5F1E8;
      --ink: #1a1a1a;
      --ink-light: #4a4a4a;
      --cream: #FFF9F0;
      --sage: #A8B5A0;
      --terracotta: #D4A59A;
      --sky: #B8D4E3;
      --lavender: #C9B8D9;
      --peach: #F4C2A5;
    }

    /* FORCER ABSOLUMENT TOUT EN NOIR */
    *:not(.activity-card):not(.activity-card *):not(.course-card):not(.course-card *) {
      color: #1a1a1a !important;
    }

    /* Labels et titres */
    label, h1, h2, h3, h4, h5, h6 {
      color: #1a1a1a !important;
    }

    /* Inputs, selects, textareas */
    input:not([type="color"]), 
    textarea, 
    select, 
    input[type="text"],
    input[type="time"],
    input[type="email"],
    input[type="password"] {
      color: #1a1a1a !important;
      -webkit-text-fill-color: #1a1a1a !important;
    }

    /* Paragraphes et spans */
    p, span, div:not(.activity-card):not(.course-card) {
      color: #1a1a1a !important;
    }

    /* Placeholders */
    ::placeholder {
      color: #8a8a8a !important;
      -webkit-text-fill-color: #8a8a8a !important;
      opacity: 1 !important;
    }

    * {
      font-family: 'Patrick Hand', cursive;
      -webkit-tap-highlight-color: transparent;
    }

    html {
      background: #F5F1E8 !important;
    }

    /* Forcer les textes principaux en noir */
    body, h1, h2, h3, label, p {
      color: #1a1a1a;
    }

    /* Textes secondaires en gris fonc√© */
    .text-slate-600, .text-slate-500, .text-slate-400 {
      color: #4a4a4a !important;
    }

    /* FORCER tous les textes dans les cartes */
    .paper-texture * {
      color: #1a1a1a !important;
    }

    .paper-texture label,
    .paper-texture h1,
    .paper-texture h2,
    .paper-texture h3,
    .paper-texture p,
    .paper-texture span,
    .paper-texture div {
      color: #1a1a1a !important;
    }

    /* Inputs et textarea */
    input, textarea, select {
      color: #1a1a1a !important;
    }

    input::placeholder,
    textarea::placeholder {
      color: #8a8a8a !important;
    }

    .font-handwritten {
      font-family: 'Caveat', cursive;
    }

    .font-script {
      font-family: 'Kalam', cursive;
    }

    body {
      background: #F5F1E8 !important;
      position: relative;
      overscroll-behavior: none;
      user-select: none;
      -webkit-user-select: none;
    }

    /* Grille √† points + texture papier */
    body::before {
      content: '';
      position: fixed;
      inset: 0;
      background-image: 
        /* Grille √† points visible */
        radial-gradient(circle, #D4C4B0 1.5px, transparent 1.5px),
        /* Texture grain papier */
        url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='3' /%3E%3CfeColorMatrix values='0 0 0 0 0, 0 0 0 0 0, 0 0 0 0 0, 0 0 0 0.02 0'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
      background-size: 25px 25px, 100%;
      background-position: 0 0, 0 0;
      pointer-events: none;
      z-index: 0;
    }

    /* D√©corations coins */
    body::after {
      content: '';
      position: fixed;
      inset: 0;
      background-image: 
        /* Petites fleurs coin haut gauche */
        url("data:image/svg+xml,%3Csvg width='150' height='150' xmlns='http://www.w3.org/2000/svg'%3E%3Cg opacity='0.25'%3E%3Ccircle cx='40' cy='35' r='6' fill='%23A8B5A0'/%3E%3Ccircle cx='52' cy='30' r='5' fill='%23A8B5A0'/%3E%3Ccircle cx='47' cy='40' r='5' fill='%23A8B5A0'/%3E%3Ccircle cx='35' cy='40' r='5' fill='%23A8B5A0'/%3E%3Ccircle cx='32' cy='30' r='5' fill='%23A8B5A0'/%3E%3Ccircle cx='42' cy='35' r='3' fill='%23D4A59A'/%3E%3Cpath d='M 20 60 Q 28 52 36 60' stroke='%23C9B8D9' stroke-width='2' fill='none'/%3E%3C/g%3E%3C/svg%3E"),
        /* Feuilles coin bas droit */
        url("data:image/svg+xml,%3Csvg width='150' height='150' xmlns='http://www.w3.org/2000/svg'%3E%3Cg opacity='0.25'%3E%3Cellipse cx='110' cy='110' rx='18' ry='9' fill='%23A8B5A0' transform='rotate(-30 110 110)'/%3E%3Cellipse cx='105' cy='120' rx='15' ry='7' fill='%23A8B5A0' transform='rotate(-45 105 120)'/%3E%3Cellipse cx='120' cy='115' rx='16' ry='8' fill='%23A8B5A0' transform='rotate(-15 120 115)'/%3E%3Cpath d='M 90 90 Q 95 85 100 90' stroke='%23D4A59A' stroke-width='2' fill='none'/%3E%3C/g%3E%3C/svg%3E"),
        /* Petites √©toiles dispers√©es */
        url("data:image/svg+xml,%3Csvg width='400' height='400' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M 100 80 L 101 82 L 103 82 L 101 83 L 102 85 L 100 84 L 98 85 L 99 83 L 97 82 L 99 82 Z' fill='%23F4C2A5' opacity='0.3'/%3E%3Cpath d='M 300 120 L 301 122 L 303 122 L 301 123 L 302 125 L 300 124 L 298 125 L 299 123 L 297 122 L 299 122 Z' fill='%23B8D4E3' opacity='0.3'/%3E%3Cpath d='M 150 300 L 151 302 L 153 302 L 151 303 L 152 305 L 150 304 L 148 305 L 149 303 L 147 302 L 149 302 Z' fill='%23C9B8D9' opacity='0.3'/%3E%3Ccircle cx='220' cy='180' r='2' fill='%23A8B5A0' opacity='0.35'/%3E%3Ccircle cx='80' cy='320' r='2' fill='%23F4C2A5' opacity='0.35'/%3E%3C/svg%3E");
      background-size: 150px auto, 150px auto, 400px auto;
      background-position: top 3% left 3%, bottom 3% right 3%, center;
      background-repeat: no-repeat, no-repeat, repeat;
      pointer-events: none;
      z-index: 0;
    }

    #root {
      position: relative;
      z-index: 1;
    }

    .paper-texture {
      background: #FFFFFF;
      box-shadow: 
        0 1px 2px rgba(0,0,0,0.03),
        0 2px 6px rgba(0,0,0,0.04),
        0 6px 16px rgba(0,0,0,0.06),
        0 12px 28px rgba(0,0,0,0.05);
      position: relative;
      border: 1px solid rgba(0,0,0,0.06);
    }

    .paper-texture::before {
      content: '';
      position: absolute;
      inset: 0;
      background-image: 
        url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='paperNoise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='1.2' numOctaves='3' /%3E%3CfeColorMatrix values='0 0 0 0 0, 0 0 0 0 0, 0 0 0 0 0, 0 0 0 0.012 0'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23paperNoise)'/%3E%3C/svg%3E");
      background-size: 100%;
      pointer-events: none;
      opacity: 0.6;
      border-radius: inherit;
    }

    .paper-texture::after {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(145deg, rgba(255,255,255,0.8) 0%, rgba(250,250,250,0.2) 100%);
      border-radius: inherit;
      pointer-events: none;
    }

    .washi-tape {
      background: 
        linear-gradient(135deg, rgba(159, 184, 154, 0.25) 0%, rgba(159, 184, 154, 0.35) 100%);
      box-shadow: 
        0 1px 3px rgba(0,0,0,0.06),
        inset 0 1px 0 rgba(255,255,255,0.3);
      position: relative;
      border: 1px solid rgba(159, 184, 154, 0.15);
    }

    .washi-tape::after {
      content: '';
      position: absolute;
      inset: 0;
      background: transparent;
      border-radius: inherit;
      pointer-events: none;
    }

    .activity-card {
      transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: grab;
      position: relative;
      border: 1px solid rgba(0,0,0,0.08);
    }

    .activity-card::before {
      content: '';
      position: absolute;
      left: -8px;
      top: 50%;
      transform: translateY(-50%);
      width: 4px;
      height: 4px;
      border-radius: 50%;
      background: currentColor;
      opacity: 0.3;
    }

    .activity-card:active {
      cursor: grabbing;
      transform: scale(1.02) rotate(1deg);
      box-shadow: 
        0 2px 4px rgba(0,0,0,0.08),
        0 6px 16px rgba(0,0,0,0.12);
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateX(-30px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    @keyframes scaleIn {
      from {
        opacity: 0;
        transform: scale(0.9);
      }
      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    .animate-fade-in-up {
      animation: fadeInUp 0.5s ease-out forwards;
    }

    .animate-slide-in {
      animation: slideIn 0.4s ease-out forwards;
    }

    .animate-scale-in {
      animation: scaleIn 0.3s ease-out forwards;
    }

    .time-marker {
      position: absolute;
      left: 0;
      right: 0;
      height: 2px;
      background: var(--terracotta);
      opacity: 0.6;
      z-index: 10;
      pointer-events: none;
    }

    .time-marker::before {
      content: '';
      position: absolute;
      left: -6px;
      top: -4px;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: var(--terracotta);
      border: 2px solid var(--cream);
    }

    input[type="time"]::-webkit-calendar-picker-indicator {
      filter: opacity(0.5);
    }

    input[type="color"] {
      width: 60px;
      height: 60px;
      border: 3px solid #1a1a1a;
      border-radius: 50%;
      cursor: pointer;
      -webkit-appearance: none;
      appearance: none;
      background: none;
    }

    input[type="color"]::-webkit-color-swatch-wrapper {
      padding: 0;
      border-radius: 50%;
    }

    input[type="color"]::-webkit-color-swatch {
      border: none;
      border-radius: 50%;
    }

    .toggle-btn {
      transition: all 0.3s ease;
    }

    .toggle-btn.active {
      background: #1a1a1a;
      color: var(--cream);
      transform: scale(1.05);
    }

    ::-webkit-scrollbar {
      width: 6px;
    }

    ::-webkit-scrollbar-track {
      background: transparent;
    }

    ::-webkit-scrollbar-thumb {
      background: rgba(0,0,0,0.2);
      border-radius: 10px;
    }

    .dashed-line {
      border-top: 2px dashed rgba(0,0,0,0.1);
    }

    .sticker {
      display: inline-block;
      padding: 4px 12px;
      background: rgba(255,255,255,0.9);
      border: 2px solid currentColor;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 600;
      box-shadow: 
        0 1px 3px rgba(0,0,0,0.08),
        0 2px 6px rgba(0,0,0,0.06);
      transform: rotate(-2deg);
      position: relative;
    }

    /* Mode sombre d√©sactiv√© - toujours en mode clair */
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    // Helpers
    const saveToStorage = (key, data) => localStorage.setItem(key, JSON.stringify(data));
    const getFromStorage = (key, defaultValue = null) => {
      const data = localStorage.getItem(key);
      return data ? JSON.parse(data) : defaultValue;
    };

    const DAYS = ['Lundi', 'Mardi', 'Mercredi', 'Jeudi', 'Vendredi'];
    
    const PRESET_COLORS = [
      '#A8B5A0', // sage
      '#D4A59A', // terracotta
      '#B8D4E3', // sky
      '#C9B8D9', // lavender
      '#F4C2A5', // peach
      '#F2C6B4', // coral
      '#A4C3B2', // mint
      '#E8B4B8', // rose
      '#D4D4AA', // khaki
      '#C4A7E7', // lilac
    ];

    function getCurrentTimePosition() {
      const now = new Date();
      const hours = now.getHours();
      const minutes = now.getMinutes();
      const totalMinutes = hours * 60 + minutes;
      const startMinutes = 7 * 60; // 7h00
      const endMinutes = 18 * 60; // 18h00
      const range = endMinutes - startMinutes;
      return ((totalMinutes - startMinutes) / range) * 100;
    }

    function WelcomePage({ onStart }) {
      const [nom, setNom] = useState('');
      const [classe, setClasse] = useState('');

      const handleSubmit = (e) => {
        e.preventDefault();
        if (nom && classe) {
          const profile = { nom, classe };
          saveToStorage('userProfile', profile);
          onStart(profile);
        }
      };

      return (
        <div 
          className="min-h-screen flex items-center justify-center p-4" 
          style={{ 
            position: 'relative',
            backgroundImage: 'url(home-bg.png)',
            backgroundSize: 'cover',
            backgroundPosition: 'center',
            backgroundRepeat: 'no-repeat'
          }}
        >
          {/* Overlay l√©ger pour am√©liorer la lisibilit√© */}
          <div 
            style={{
              position: 'absolute',
              inset: 0,
              background: 'rgba(245, 241, 232, 0.7)',
              zIndex: 0
            }}
          />
          
          <div className="w-full max-w-md animate-scale-in" style={{ position: 'relative', zIndex: 1 }}>
            <div className="text-center mb-8">
              <h1 className="text-6xl font-handwritten mb-2" style={{ color: '#1a1a1a' }}>
                Mon Bullet Journal
              </h1>
              <div className="text-4xl mb-4">üìî‚ú®</div>
              <p className="text-lg" style={{ color: '#4a4a4a' }}>
                Organise ta semaine en toute simplicit√©
              </p>
            </div>

            <div className="paper-texture rounded-3xl p-8" style={{ border: '3px solid #1a1a1a' }}>
              <form onSubmit={handleSubmit} className="space-y-6">
                <div>
                  <label className="block text-lg font-handwritten mb-2" style={{ color: '#1a1a1a' }}>
                    Ton pr√©nom ‚úèÔ∏è
                  </label>
                  <input
                    type="text"
                    value={nom}
                    onChange={(e) => setNom(e.target.value)}
                    className="w-full px-4 py-3 rounded-2xl text-lg font-handwritten"
                    style={{ 
                      border: '2px solid #1a1a1a',
                      background: 'var(--paper)',
                      color: '#1a1a1a'
                    }}
                    placeholder="Marie"
                    required
                  />
                </div>

                <div>
                  <label className="block text-lg font-handwritten mb-2" style={{ color: '#1a1a1a' }}>
                    Ta classe üéí
                  </label>
                  <input
                    type="text"
                    value={classe}
                    onChange={(e) => setClasse(e.target.value)}
                    className="w-full px-4 py-3 rounded-2xl text-lg font-handwritten"
                    style={{ 
                      border: '2px solid #1a1a1a',
                      background: 'var(--paper)',
                      color: '#1a1a1a'
                    }}
                    placeholder="CP A, CE1..."
                    required
                  />
                </div>

                <button
                  type="submit"
                  className="w-full py-4 rounded-2xl text-xl font-handwritten font-bold transition-all transform hover:scale-105 active:scale-95"
                  style={{
                    background: 'var(--sage)',
                    color: 'var(--cream)',
                    border: '3px solid #1a1a1a',
                    boxShadow: '4px 4px 0 #1a1a1a'
                  }}
                >
                  Commencer mon journal ‚ú®
                </button>
              </form>
            </div>

            <p className="text-center text-sm mt-6" style={{ color: '#4a4a4a' }}>
              Tes donn√©es restent sur ton appareil üîí
            </p>
          </div>
        </div>
      );
    }

    function ActivityModal({ isOpen, onClose, onSave, editingActivity }) {
      const [title, setTitle] = useState('');
      const [startTime, setStartTime] = useState('09:00');
      const [duration, setDuration] = useState(60);
      const [color, setColor] = useState(PRESET_COLORS[0]);
      const [selectedDays, setSelectedDays] = useState([]);

      useEffect(() => {
        if (editingActivity) {
          setTitle(editingActivity.title);
          setStartTime(editingActivity.startTime);
          setDuration(editingActivity.duration);
          setColor(editingActivity.color);
          setSelectedDays([editingActivity.day]);
        } else {
          setTitle('');
          setStartTime('09:00');
          setDuration(60);
          setColor(PRESET_COLORS[0]);
          setSelectedDays([]);
        }
      }, [editingActivity, isOpen]);

      const toggleDay = (day) => {
        setSelectedDays(prev =>
          prev.includes(day) ? prev.filter(d => d !== day) : [...prev, day]
        );
      };

      const handleSubmit = (e) => {
        e.preventDefault();
        if (!title || selectedDays.length === 0) return;

        const activities = selectedDays.map(day => ({
          id: editingActivity?.id || `${Date.now()}-${Math.random()}`,
          title,
          startTime,
          duration,
          color,
          day,
          createdAt: editingActivity?.createdAt || Date.now()
        }));

        onSave(activities, editingActivity?.id);
        onClose();
      };

      if (!isOpen) return null;

      return (
        <div 
          className="fixed inset-0 flex items-center justify-center p-4 z-50 animate-fade-in-up"
          style={{ background: 'rgba(0,0,0,0.4)', backdropFilter: 'blur(8px)' }}
          onClick={onClose}
        >
          <div 
            className="paper-texture rounded-3xl p-6 w-full max-w-lg animate-scale-in"
            style={{ border: '3px solid #1a1a1a' }}
            onClick={(e) => e.stopPropagation()}
          >
            <h2 className="text-3xl font-handwritten mb-6" style={{ color: '#1a1a1a' }}>
              {editingActivity ? '‚úèÔ∏è Modifier' : '‚ú® Nouvelle activit√©'}
            </h2>

            <form onSubmit={handleSubmit} className="space-y-5">
              <div>
                <label className="block text-lg font-handwritten mb-2" style={{ color: '#1a1a1a' }}>
                  Titre de l'activit√©
                </label>
                <input
                  type="text"
                  value={title}
                  onChange={(e) => setTitle(e.target.value)}
                  className="w-full px-4 py-3 rounded-2xl text-lg font-handwritten"
                  style={{ 
                    border: '2px solid #1a1a1a',
                    background: 'var(--paper)',
                    color: '#1a1a1a'
                  }}
                  placeholder="Math√©matiques, R√©cr√©ation..."
                  required
                />
              </div>

              <div className="grid grid-cols-2 gap-4">
                <div>
                  <label className="block text-lg font-handwritten mb-2" style={{ color: '#1a1a1a' }}>
                    ‚è∞ Heure
                  </label>
                  <input
                    type="time"
                    value={startTime}
                    onChange={(e) => setStartTime(e.target.value)}
                    className="w-full px-4 py-3 rounded-2xl text-lg font-handwritten"
                    style={{ 
                      border: '2px solid #1a1a1a',
                      background: 'var(--paper)',
                      color: '#1a1a1a'
                    }}
                    required
                  />
                </div>

                <div>
                  <label className="block text-lg font-handwritten mb-2" style={{ color: '#1a1a1a' }}>
                    ‚è±Ô∏è Dur√©e (min)
                  </label>
                  <select
                    value={duration}
                    onChange={(e) => setDuration(Number(e.target.value))}
                    className="w-full px-4 py-3 rounded-2xl text-lg font-handwritten"
                    style={{ 
                      border: '2px solid #1a1a1a',
                      background: 'var(--paper)',
                      color: '#1a1a1a'
                    }}
                  >
                    <option value={15}>15 min</option>
                    <option value={30}>30 min</option>
                    <option value={45}>45 min</option>
                    <option value={60}>1h</option>
                    <option value={90}>1h30</option>
                    <option value={120}>2h</option>
                  </select>
                </div>
              </div>

              <div>
                <label className="block text-lg font-handwritten mb-3" style={{ color: '#1a1a1a' }}>
                  üé® Couleur
                </label>
                <div className="flex flex-wrap gap-3">
                  {PRESET_COLORS.map(presetColor => (
                    <button
                      key={presetColor}
                      type="button"
                      onClick={() => setColor(presetColor)}
                      className="w-12 h-12 rounded-full transition-all"
                      style={{
                        background: presetColor,
                        border: color === presetColor ? '4px solid #1a1a1a' : '2px solid #1a1a1a',
                        transform: color === presetColor ? 'scale(1.1)' : 'scale(1)'
                      }}
                    />
                  ))}
                  <input
                    type="color"
                    value={color}
                    onChange={(e) => setColor(e.target.value)}
                    title="Couleur personnalis√©e"
                  />
                </div>
              </div>

              <div>
                <label className="block text-lg font-handwritten mb-3" style={{ color: '#1a1a1a' }}>
                  üìÖ Jours
                </label>
                <div className="flex flex-wrap gap-2">
                  {DAYS.map(day => (
                    <button
                      key={day}
                      type="button"
                      onClick={() => toggleDay(day)}
                      className="px-4 py-2 rounded-xl font-handwritten transition-all"
                      style={{
                        background: selectedDays.includes(day) ? '#1a1a1a' : 'var(--paper)',
                        color: selectedDays.includes(day) ? 'var(--cream)' : '#1a1a1a',
                        border: '2px solid #1a1a1a',
                        transform: selectedDays.includes(day) ? 'scale(1.05)' : 'scale(1)'
                      }}
                    >
                      {day}
                    </button>
                  ))}
                </div>
              </div>

              <div className="flex gap-3 pt-4">
                <button
                  type="button"
                  onClick={onClose}
                  className="flex-1 py-3 rounded-2xl font-handwritten text-lg transition-all"
                  style={{
                    background: 'var(--paper)',
                    color: '#1a1a1a',
                    border: '2px solid #1a1a1a'
                  }}
                >
                  Annuler
                </button>
                <button
                  type="submit"
                  className="flex-1 py-3 rounded-2xl font-handwritten text-lg font-bold transition-all"
                  style={{
                    background: color,
                    color: 'var(--cream)',
                    border: '3px solid #1a1a1a',
                    boxShadow: '3px 3px 0 #1a1a1a'
                  }}
                >
                  {editingActivity ? 'Modifier' : 'Ajouter'}
                </button>
              </div>
            </form>
          </div>
        </div>
      );
    }

    function ActivityCard({ activity, onEdit, onDelete }) {
      const [startHour, startMinute] = activity.startTime.split(':').map(Number);
      const totalStartMinutes = startHour * 60 + startMinute;
      const startOfDay = 7 * 60; // 7h
      const endOfDay = 18 * 60; // 18h
      const dayRange = endOfDay - startOfDay;
      
      const top = ((totalStartMinutes - startOfDay) / dayRange) * 100;
      const height = (activity.duration / dayRange) * 100;

      return (
        <div
          className="activity-card absolute left-2 right-2 rounded-2xl p-3"
          style={{
            top: `${top}%`,
            height: `${Math.max(height, 8)}%`,
            background: activity.color,
            color: 'var(--cream)',
            border: '2px solid #1a1a1a',
            boxShadow: '2px 2px 0 #1a1a1a',
            minHeight: '60px'
          }}
          onClick={() => onEdit(activity)}
        >
          <div className="flex justify-between items-start">
            <div className="flex-1 pr-2">
              <div className="font-bold text-base leading-tight mb-1 font-handwritten">
                {activity.title}
              </div>
              <div className="text-sm opacity-90">
                {activity.startTime} ‚Ä¢ {activity.duration}min
              </div>
            </div>
            <button
              onClick={(e) => {
                e.stopPropagation();
                onDelete(activity.id);
              }}
              className="text-lg opacity-70 hover:opacity-100 transition-opacity"
            >
              ‚úï
            </button>
          </div>
        </div>
      );
    }

    function DayView({ activities, selectedDay, onEdit, onDelete }) {
      const dayActivities = activities.filter(a => a.day === selectedDay);
      const [currentTimePos, setCurrentTimePos] = useState(getCurrentTimePosition());

      useEffect(() => {
        const interval = setInterval(() => {
          setCurrentTimePos(getCurrentTimePosition());
        }, 60000);
        return () => clearInterval(interval);
      }, []);

      return (
        <div className="space-y-4">
          <h2 className="text-4xl font-handwritten text-center mb-6" style={{ color: '#1a1a1a' }}>
            {selectedDay}
          </h2>

          <div className="paper-texture rounded-3xl p-6 relative" style={{ border: '3px solid #1a1a1a', minHeight: '600px' }}>
            <div className="relative" style={{ height: '660px' }}>
              {/* Lignes horaires */}
              {[7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18].map(hour => {
                const pos = ((hour - 7) / 11) * 100;
                return (
                  <div
                    key={hour}
                    className="absolute left-0 right-0 flex items-center"
                    style={{ top: `${pos}%` }}
                  >
                    <div className="w-16 text-right pr-3 font-handwritten text-lg" style={{ color: '#4a4a4a' }}>
                      {hour}h
                    </div>
                    <div className="flex-1 dashed-line" />
                  </div>
                );
              })}

              {/* Indicateur heure actuelle */}
              {currentTimePos >= 0 && currentTimePos <= 100 && (
                <div className="time-marker" style={{ top: `${currentTimePos}%` }} />
              )}

              {/* Activit√©s */}
              <div className="absolute left-20 right-0 top-0 bottom-0">
                {dayActivities.map(activity => (
                  <ActivityCard
                    key={activity.id}
                    activity={activity}
                    onEdit={onEdit}
                    onDelete={onDelete}
                  />
                ))}
              </div>
            </div>
          </div>
        </div>
      );
    }

    function WeekView({ activities, onEdit, onDelete }) {
      return (
        <div className="space-y-4">
          <h2 className="text-4xl font-handwritten text-center mb-6" style={{ color: '#1a1a1a' }}>
            Ma Semaine
          </h2>

          <div className="grid grid-cols-1 md:grid-cols-5 gap-4">
            {DAYS.map((day, index) => {
              const dayActivities = activities.filter(a => a.day === day);
              return (
                <div 
                  key={day}
                  className="paper-texture rounded-2xl p-4 animate-slide-in"
                  style={{ 
                    border: '2px solid #1a1a1a',
                    animationDelay: `${index * 0.1}s`
                  }}
                >
                  <h3 className="text-2xl font-handwritten mb-3 text-center" style={{ color: '#1a1a1a' }}>
                    {day}
                  </h3>
                  <div className="space-y-2">
                    {dayActivities
                      .sort((a, b) => a.startTime.localeCompare(b.startTime))
                      .map(activity => (
                        <div
                          key={activity.id}
                          className="rounded-xl p-3 cursor-pointer transition-all hover:scale-105"
                          style={{
                            background: activity.color,
                            color: 'var(--cream)',
                            border: '2px solid #1a1a1a',
                            boxShadow: '2px 2px 0 #1a1a1a'
                          }}
                          onClick={() => onEdit(activity)}
                        >
                          <div className="font-bold text-sm mb-1">{activity.title}</div>
                          <div className="text-xs opacity-90">{activity.startTime}</div>
                        </div>
                      ))}
                    {dayActivities.length === 0 && (
                      <div className="text-center py-8" style={{ color: '#4a4a4a' }}>
                        <div className="text-2xl mb-2">‚ú®</div>
                        <div className="text-sm">Aucune activit√©</div>
                      </div>
                    )}
                  </div>
                </div>
              );
            })}
          </div>
        </div>
      );
    }

    function Dashboard({ userProfile, onLogout }) {
      const [activities, setActivities] = useState([]);
      const [viewMode, setViewMode] = useState('week'); // 'day' or 'week'
      const [selectedDay, setSelectedDay] = useState(DAYS[new Date().getDay() - 1] || DAYS[0]);
      const [modalOpen, setModalOpen] = useState(false);
      const [editingActivity, setEditingActivity] = useState(null);

      useEffect(() => {
        const saved = getFromStorage('activities', []);
        setActivities(saved);
      }, []);

      useEffect(() => {
        saveToStorage('activities', activities);
      }, [activities]);

      const handleSaveActivity = (newActivities, editingId) => {
        if (editingId) {
          // Mode √©dition : remplacer l'activit√©
          setActivities(activities.map(a => 
            a.id === editingId ? newActivities[0] : a
          ));
        } else {
          // Mode ajout : ajouter toutes les nouvelles activit√©s
          setActivities([...activities, ...newActivities]);
        }
      };

      const handleEditActivity = (activity) => {
        setEditingActivity(activity);
        setModalOpen(true);
      };

      const handleDeleteActivity = (id) => {
        if (confirm('Supprimer cette activit√© ?')) {
          setActivities(activities.filter(a => a.id !== id));
        }
      };

      const handleAddNew = () => {
        setEditingActivity(null);
        setModalOpen(true);
      };

      return (
        <div className="min-h-screen p-4 md:p-8 pb-24">
          <div className="max-w-7xl mx-auto">
            {/* Header */}
            <div className="mb-8 animate-fade-in-up">
              <div className="paper-texture rounded-3xl p-6" style={{ border: '3px solid #1a1a1a' }}>
                <div className="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                  <div>
                    <h1 className="text-4xl md:text-5xl font-handwritten mb-2" style={{ color: '#1a1a1a' }}>
                      Hello {userProfile.nom} ! üëã
                    </h1>
                    <div className="sticker" style={{ color: 'var(--terracotta)', borderColor: 'var(--terracotta)' }}>
                      {userProfile.classe}
                    </div>
                  </div>
                  <button
                    onClick={onLogout}
                    className="px-6 py-3 rounded-2xl font-handwritten text-lg transition-all"
                    style={{
                      background: 'var(--paper)',
                      color: '#1a1a1a',
                      border: '2px solid #1a1a1a'
                    }}
                  >
                    D√©connexion
                  </button>
                </div>
              </div>
            </div>

            {/* View Toggle */}
            <div className="flex justify-center gap-3 mb-8">
              <button
                onClick={() => setViewMode('day')}
                className={`toggle-btn px-8 py-3 rounded-2xl font-handwritten text-xl ${viewMode === 'day' ? 'active' : ''}`}
                style={{
                  background: viewMode === 'day' ? '#1a1a1a' : 'var(--paper)',
                  color: viewMode === 'day' ? 'var(--cream)' : '#1a1a1a',
                  border: '3px solid #1a1a1a',
                  boxShadow: viewMode === 'day' ? '3px 3px 0 var(--terracotta)' : 'none'
                }}
              >
                üìÖ Jour
              </button>
              <button
                onClick={() => setViewMode('week')}
                className={`toggle-btn px-8 py-3 rounded-2xl font-handwritten text-xl ${viewMode === 'week' ? 'active' : ''}`}
                style={{
                  background: viewMode === 'week' ? '#1a1a1a' : 'var(--paper)',
                  color: viewMode === 'week' ? 'var(--cream)' : '#1a1a1a',
                  border: '3px solid #1a1a1a',
                  boxShadow: viewMode === 'week' ? '3px 3px 0 var(--sage)' : 'none'
                }}
              >
                üìÜ Semaine
              </button>
            </div>

            {/* Day selector for day view */}
            {viewMode === 'day' && (
              <div className="flex justify-center gap-2 mb-6 overflow-x-auto pb-2">
                {DAYS.map(day => (
                  <button
                    key={day}
                    onClick={() => setSelectedDay(day)}
                    className="px-4 py-2 rounded-xl font-handwritten text-lg whitespace-nowrap transition-all"
                    style={{
                      background: selectedDay === day ? 'var(--sage)' : 'var(--paper)',
                      color: selectedDay === day ? 'var(--cream)' : '#1a1a1a',
                      border: '2px solid #1a1a1a',
                      transform: selectedDay === day ? 'scale(1.05)' : 'scale(1)'
                    }}
                  >
                    {day}
                  </button>
                ))}
              </div>
            )}

            {/* Main View */}
            {viewMode === 'day' ? (
              <DayView
                activities={activities}
                selectedDay={selectedDay}
                onEdit={handleEditActivity}
                onDelete={handleDeleteActivity}
              />
            ) : (
              <WeekView
                activities={activities}
                onEdit={handleEditActivity}
                onDelete={handleDeleteActivity}
              />
            )}

            {/* Stats */}
            <div className="mt-8 grid grid-cols-2 md:grid-cols-4 gap-4">
              <div className="paper-texture rounded-2xl p-4 text-center" style={{ border: '2px solid #1a1a1a' }}>
                <div className="text-3xl font-bold font-handwritten" style={{ color: 'var(--sage)' }}>
                  {activities.length}
                </div>
                <div className="text-sm" style={{ color: '#4a4a4a' }}>Activit√©s</div>
              </div>
              <div className="paper-texture rounded-2xl p-4 text-center" style={{ border: '2px solid #1a1a1a' }}>
                <div className="text-3xl font-bold font-handwritten" style={{ color: 'var(--terracotta)' }}>
                  {DAYS.filter(day => activities.some(a => a.day === day)).length}
                </div>
                <div className="text-sm" style={{ color: '#4a4a4a' }}>Jours remplis</div>
              </div>
              <div className="paper-texture rounded-2xl p-4 text-center" style={{ border: '2px solid #1a1a1a' }}>
                <div className="text-3xl font-bold font-handwritten" style={{ color: 'var(--sky)' }}>
                  {Math.round(activities.reduce((sum, a) => sum + a.duration, 0) / 60)}h
                </div>
                <div className="text-sm" style={{ color: '#4a4a4a' }}>Total</div>
              </div>
              <div className="paper-texture rounded-2xl p-4 text-center" style={{ border: '2px solid #1a1a1a' }}>
                <div className="text-3xl font-bold font-handwritten" style={{ color: 'var(--lavender)' }}>
                  {new Set(activities.map(a => a.title)).size}
                </div>
                <div className="text-sm" style={{ color: '#4a4a4a' }}>Types</div>
              </div>
            </div>
          </div>

          {/* Floating Add Button */}
          <button
            onClick={handleAddNew}
            className="fixed bottom-8 right-8 w-16 h-16 rounded-full flex items-center justify-center text-3xl transition-all transform hover:scale-110 active:scale-95 z-50"
            style={{
              background: 'linear-gradient(135deg, #A8B5A0 0%, #8A9780 100%)',
              color: 'var(--cream)',
              border: '3px solid #1a1a1a',
              boxShadow: '4px 4px 0 #1a1a1a, 0 0 0 6px rgba(168, 181, 160, 0.2)'
            }}
          >
            ‚úèÔ∏è
          </button>

          <ActivityModal
            isOpen={modalOpen}
            onClose={() => {
              setModalOpen(false);
              setEditingActivity(null);
            }}
            onSave={handleSaveActivity}
            editingActivity={editingActivity}
          />
        </div>
      );
    }

    function App() {
      const [userProfile, setUserProfile] = useState(null);

      useEffect(() => {
        const profile = getFromStorage('userProfile');
        if (profile) {
          setUserProfile(profile);
        }
      }, []);

      const handleStart = (profile) => {
        setUserProfile(profile);
      };

      const handleLogout = () => {
        if (confirm('Te d√©connecter ? Tes activit√©s seront conserv√©es.')) {
          setUserProfile(null);
        }
      };

      return userProfile ? (
        <Dashboard userProfile={userProfile} onLogout={handleLogout} />
      ) : (
        <WelcomePage onStart={handleStart} />
      );
    }

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>
